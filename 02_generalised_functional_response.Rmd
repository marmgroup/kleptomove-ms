---
output: html_document
editor_options: 
  chunk_output_type: console
---

# Plotting functional responses

```{r}
#### Code for functional response

# load libraries
library(tidyr)
library(stringi)
library(glue)
library(ggplot2)
library(data.table)

# some helper functions
source("code/functional_response.R")
```

Prepare to read data.

```{r}
# simulation type
sim_type <- c("obligate", "facultative", "foragers", "random")

# get the replicates
replicate <- stringr::str_pad(seq_len(3), pad = "0", width = 3)

# growth rates
regrowth <- c(0.001, 0.01, 0.03, 0.05)

# glue data folder names together
data <- crossing(
  sim_type,
  replicate,
  regrowth
)

# get folders
data$folder_path <- glue_data(.x = data,
                              'data/sim_{sim_type}_rep_{replicate}_\\
                                      gro_{regrowth}')
```

Summarise the data and read it in, using the helper functions.

```{r}
# get data
data$data_summary <- lapply(data$folder_path,
                            get_functional_response)

# unnest the data
data <- unnest(data,
               cols = "data_summary")
```

Prepare the data for plotting.

```{r}
# set dt
setDT(data)
data <- split(data, by = "regrowth")
```

Make list of plots.

```{r}
fig_fun_response <- 
  lapply(data, function(df) {
    ggplot(df)+
  geom_abline(slope = 1)+
  geom_tile(aes(items, total_agents, 
                fill = value + 1e-6))+
  facet_grid(replicate~variable)+
  # scico::scale_fill_scico(palette = "oslo",
  #                         direction = -1
  #                         # breaks = c(1e-2, 1e0),
  #                         # labels = c("lower", "higher")
  #                         )+
  scale_fill_viridis_c(na.value = "grey",
                       option = "B", direction = -1,
                       limits = c(0, 1))+
  # coord_equal(xlim = c(0, 0.25),
  #             ylim = c(0, 0.25))+
  theme_minimal()+
  theme(legend.position = "top",
        # panel.grid = element_blank(),
        legend.key.height = unit(2, units = "mm"),
        axis.title = element_text(face = "bold"),
        legend.title = element_text(face = "bold"))+
  labs(fill = "p.c.in.",
       x = "items",
       y = "agents")
  })
```



```{r}

```