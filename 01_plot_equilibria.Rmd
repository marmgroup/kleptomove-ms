---
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r}
library(data.table)
# plotting
library(ggplot2)
library(colorspace)
library(patchwork)
```

```{r}
data <- fread("data/results/data_strategy_gen.csv")
# rearrange
data$sim_type <- factor(data$sim_type,
  levels = c("foragers", "obligate", "facultative")
)
```

```{r}
# basic plot
fig_strategy_gen <-
  ggplot(data[sim_type != "foragers" &
    (gen %% 10 == 0 | gen < 100)]) +
  geom_line(aes(gen, value,
    col = variable,
    group = interaction(
      sim_type,
      regrowth,
      replicate,
      variable
    )
  ),
  size = 0.5
  ) +
  facet_grid(sim_type ~ regrowth) +
  scale_color_manual(
    values = qualitative_hcl(3, "Set2", l = 40, rev = T)
  ) +
  theme_custom(grid = T) +
  scale_x_log10() +
  labs(
    y = "proportion of population",
    x = "generations"
  )
```

```{r}
ggsave(fig_strategy_gen,
  filename = "figures/fig_strategy_generations.png",
  dpi = 150
)
```

### Plot for regrowth = 0.1

```{r}
data_0.1 <- data[(gen %% 10 == 0 | gen < 100) & regrowth == 0.1]

# split
data_0.1 <- split(data_0.1, by = "sim_type")

# subfigures
subfig_strategy_gen <- lapply(data_0.1, function(df) {
  ggplot(df) +
    geom_line(aes(gen, value,
      col = variable,
      group = interaction(
        sim_type,
        regrowth,
        replicate,
        variable
      )
    ),
    size = 0.5
    ) +
    scale_color_manual(
      values = qualitative_hcl(3, "Set2", l = 40, rev = T)
    ) +
    scale_y_continuous(
      labels = scales::percent,
      breaks = seq(0, 0.75, 0.25)
    ) +
    kleptomoveMS::theme_custom(grid = F, base_size = 8) +
    coord_cartesian(ylim = c(0, 0.75)) +
    scale_x_sqrt(breaks = c(0, 10, 100, 500, 1000)) +
    labs(
      y = "% population", x = NULL
    )
})
```

### Plot fitness

```{r}
data_summary = data[(regrowth == 0.1) &
                      (gen %% 10 == 0 | gen < 100)]
data_summary = unique(data_summary, 
                      by = c("sim_type", "replicate",
                             "pop_fitness"))
data_summary <- split(data_summary, by = "sim_type")

subfig_fitness = lapply(data_summary, function(df) {
  ggplot(df)+
  geom_line(aes(gen, pop_fitness,
                group = interaction(sim_type, replicate)),
            col = "grey20"
  )+
  kleptomoveMS::theme_custom(grid = F, base_size = 8) +
  coord_fixed(ylim = c(10, 55), ratio = 0.5) +
  scale_x_sqrt(breaks = c(0, 10, 100, 500, 1000)) +
  labs(
    y = "pop. intake",
    x = "generations"
  )
})
```


```{r}
# make figure
fig_strategy_gen <-
  wrap_plots(
    append(subfig_strategy_gen[c("foragers", "obligate", "facultative")],
           subfig_fitness[c("foragers", "obligate", "facultative")])
  ) +
    plot_annotation(
      tag_levels = "a",
      tag_prefix = "(",
      tag_suffix = ")"
    ) &
    theme(plot.tag = element_text(
      face = "bold",
      size = 12
    ))
```

```{r}
ggsave(fig_strategy_gen,
  filename = "figures/fig_02_strategy_generations.png",
  height = 3.5, width = 6
)
```

