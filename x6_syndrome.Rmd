---
output: html_document
editor_options: 
  chunk_output_type: console
---

# Behavioural syndrome

```{r}
# to handle data and plot
library(data.table)
library(glue)

library(ggplot2)
library(colorspace)
library(patchwork)
```

```{r}
# get data
data <- fread("data_sim/results/data_syndrome.csv")

# klept_bias FALSE = kleptoparasite strategy
```

```{r}
# get proportion
data[, prop := N / sum(N), by = c("gen", "klept_bias", "regrowth", "replicate")]

# group generations in tens
data[, gen_round := round(gen, -1)]

# recode variables
data[, c("klept_bias", "handler_pref") := list(
  factor(ifelse(klept_bias, "forager", "klept")),
  factor(ifelse(handler_pref, "prefers handlers", "avoids handlers"),
    levels = c("prefers handlers", "avoids handlers")
  )
)]

# summarise
data_summary <- data[,
  list(
    mean_prop = mean(prop),
    sd_prop = sd(prop)
  ),
  by = c("gen", "klept_bias", "handler_pref", "regrowth")
]
```

```{r}
fig_6 = 
ggplot(data[regrowth == 0.01, ]) +
  geom_line(
    aes(
      x = gen,
      y = prop,
      col = interaction(klept_bias, handler_pref),
      # size = handler_pref,
      group = interaction(klept_bias, handler_pref, replicate)
    )
  ) +
  scale_size_manual(
    values = c(
      "prefers handlers" = 0.5,
      "avoids handlers" = 0.2
    ),
    name = "Movement",
    breaks = c("prefers handlers", "avoids handlers")
  ) +
  scale_colour_manual(
    values = c(
      "forager.prefers handlers" = "royalblue",
      "forager.avoids handlers" = "lightblue",
      "klept.prefers handlers" = "darkred",
      "klept.avoids handlers" = "indianred"
    ),
    name = NULL,
    labels = c(
      "forager.prefers handlers" = "Forager, prefers handlers",
      "forager.avoids handlers" = "Forager, avoids handlers",
      "klept.prefers handlers" = "Klept., prefers handlers",
      "klept.avoids handlers" = "Klept., avoids handlers"
    )
  ) +
  coord_cartesian(
    ylim = c(0, 1),
    xlim = c(1, 50)
  ) +
  labs(
    x = "Generation",
    y = "Prop. handler response"
  ) +
  scale_x_log10()+
  kleptomoveMS::theme_custom(grid = T, base_size = 8) +
  theme(legend.position = "top",
        legend.key.height = unit(1, units = "mm"))+
  guides(colour = guide_legend(nrow = 2, byrow = TRUE))
```

```{r}
ggsave(fig_6,
       filename = "figures/fig_07.png",
       width = 80,
       height = 80, units = "mm")
```

