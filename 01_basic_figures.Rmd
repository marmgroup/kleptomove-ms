---
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r}
#### code to make a basic overall plot
# load libraries
library(tidyr)
library(stringi)
library(glue)
library(ggplot2)
library(data.table)

library(colorspace)
# some helper functions
source("code/helper_functions.R")
```

Read the capacity layer.

```{r}
# read in the capacity
capacity <- png::readPNG("data/data_parameters/kernels32.png")[,,1]

max_capacity <- 5L

capacity <- round(capacity * max_capacity, digits = 1)
```

Plot the capacity layer.

```{r}
sample_size <- 2 ^ 6
landscape_mini <- capacity[seq(sample_size), seq(sample_size)]
landscape_mini <- as.data.table(landscape_mini)

# prepare to plot
setnames(landscape_mini, as.character(seq(ncol(landscape_mini))))
# melt after setting x
landscape_mini[, x := seq(nrow(landscape_mini))]
landscape_mini <- melt(landscape_mini,
                       value.name = "capacity",
                       id.vars = "x",
                       variable.name = "y")
# make numeric
landscape_mini[, y := as.numeric(y)]
```

```{r}
# plot and save
fig_landscape_mini <-
  ggplot(landscape_mini)+
  geom_tile(aes(x, y, fill = capacity),
            show.legend = T)+
  scale_fill_viridis_c()+
  coord_equal()+
  theme_void()+
  theme(legend.position = "top",
        legend.key.height = unit(2, units = "mm"))

ggsave(fig_landscape_mini,
       filename = "figures/fig_landscape_mini.png",
       height = 80, width = 80, units = "mm", dpi = 150)
```


Prepare to read data.

```{r}
# simulation type
sim_type <- c("obligate", "facultative", "foragers", "random")

# get the replicates
replicate <- stringr::str_pad(seq_len(2), pad = "0", width = 3)

# growth rates
regrowth <- c(0.001, 0.01, 0.03, 0.05,
              0.02, 0.04, 0.075, 0.1, 0.25, 0.005)

# glue data folder names together
data <- crossing(
  sim_type,
  replicate,
  regrowth
)

# get folders
data$folder_path <- glue_data(.x = data,
                              'data/sim_{sim_type}_rep_{replicate}_\\
                                      gro_{regrowth}')
```

Summarise the data and read it in, using the helper functions.

```{r}
# get data
data$data_summary <- lapply(data$folder_path,
                            get_sim_summary, capacity_matrix = capacity)

# unnest the data
data <- unnest(data,
               cols = "data_summary")

fwrite(data, "data/results/data_agent_distribution.csv")
```
