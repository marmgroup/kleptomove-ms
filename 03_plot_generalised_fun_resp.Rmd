---
output: html_document
editor_options: 
  chunk_output_type: console
---

# Generalised Response: Items and all Individuals

```{r}
library(data.table)
library(ggplot2)
library(pals)

# custom functions
source("code/functional_response.R")
```


## Get data

```{r}
# read general fun response and split by sim type
data <- fread("data/data_funresp_general.csv")

# subset for max regrowth
data <- data[regrowth == max(regrowth)]

# round over more items
data[, items_round := floor_any(items, 0.01)]

# get summary
df <- data[, list(value = mean(value)),
  by = c(
    "sim_type",
    "items_round", "total_agents", "variable"
  )
]
```

```{r}
# split by sim type
df <- split(df, by = "sim_type")
```


```{r}
fig_fun_response <-
  lapply(df, function(df) {
    ggplot(df) +
      # geom_vline(xintercept = item_levels,
      #            lty = 2, lwd = 0.25)+
      geom_tile(aes(items_round, total_agents,
        fill = value
      ),
      show.legend = T
      ) +
      facet_grid(sim_type ~ variable) +
      # coord_fixed(ratio = 20)+
      scale_fill_gradientn(
        colours = (pals::cubehelix(10, r = -2.5)),
        limits = c(1e-6, 0.3),
        breaks = seq(0, 0.3, 0.1),
        na.value = NA
      ) +
      theme_bw(base_size = 8, base_family = "sans") +
      theme(
        legend.position = "top",
        # panel.grid = element_blank(),
        legend.key.height = unit(1, units = "mm"),
        legend.background = element_blank()
      ) +
      labs(
        fill = "per-captia\nintake",
        x = "# food items",
        y = "# individuals"
      )
  })

fig_fun_response <- patchwork::wrap_plots(fig_fun_response[c(
  "foragers",
  "obligate",
  "facultative",
  "random"
)],
ncol = 1,
guides = "collect"
) &
  theme(legend.position = "top")
fig_fun_response
# fig_fun_response[[3]]
```

```{r}
ggsave(fig_fun_response,
  filename = "figures/fig_fun_response_general.png",
  dpi = 150
)
```
