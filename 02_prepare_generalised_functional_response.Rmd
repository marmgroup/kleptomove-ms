---
output: html_document
editor_options: 
  chunk_output_type: console
---

# Plotting functional responses

## Plotting replicates separately

```{r}
#### Code for functional response

# load libraries
library(tidyr)
library(stringi)
library(glue)
library(ggplot2)
library(data.table)

# some helper functions
source("code/functional_response.R")
```

Prepare to read data.

```{r}
# simulation type
sim_type <- c("obligate", "facultative", "foragers")

# get the replicates
replicate <- stringr::str_pad(seq_len(3), pad = "0", width = 3)

# growth rates -- read only 0.05
regrowth <- c(0.001, 0.01, 0.03, 0.05,
              0.02, 0.04, 0.075, 0.1, 0.25, 0.005)

# glue data folder names together
data <- crossing(
  sim_type,
  replicate,
  regrowth
)

# get folders
data$folder_path <- glue_data(.x = data,
                              'data/sim_{sim_type}_rep_{replicate}_\\
                                      gro_{regrowth}')
```

Write param combinations.

```{r}
fwrite(data, "data/data_param_combinations.csv")
```

## Function response: PC Intake ~ all agents

Summarise the data and read it in, using the helper functions.

```{r}
# get data
data$data_summary <- lapply(data$folder_path, function(x) {
  get_functional_response(
    data_folder = x,
    round_value = 0.005,
    drivers = c("total_agents")
  )
})

# unnest the data
data_summary <- unnest(data,
               cols = "data_summary")
# write file
fwrite(data_summary, file = "data/results/data_funresp_agents.csv")
```

## Functional response: PC Intake ~ klepts and foragers

```{r}
# remove old
data$data_summary <- NULL
gc()

# get new data
data$data_summary <- lapply(data$folder_path, function(x) {
  get_functional_response(
    data_folder = x,
    round_value = 0.005,
    drivers = c("klepts", "foragers")
  )
})

# unnest the data
data_summary <- unnest(data,
               cols = "data_summary")

# write to file
fwrite(data_summary, file = "data/results/data_funresp_strategy.csv")
```

## Functional response: All agents, klepts, foragers ~ items

```{r}
# remove old
data$data_summary <- NULL
gc()

# get data
data$data_summary <- lapply(data$folder_path, function(x) {
  get_functional_response(
    data_folder = x,
    round_value = 0.001,
    response = c("total_agents", "klepts", "foragers"),
    drivers = c("items")
  )
})

# unnest the data
data_summary <- unnest(data,
               cols = "data_summary")

# write 
fwrite(data_summary, file = "data/results/data_funresp_predators_items.csv")
```
