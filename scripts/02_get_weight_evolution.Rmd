---
output: html_document
editor_options:
  chunk_output_type: console
---

# Prepare relative preference evolution data

## Load libraries

```{r}
# load libs
library(data.table)
library(kleptomoveMS)
```

## Get transformed cue preferences

Prepare data paths.

```{r }
# read paths
paths <- list.dirs("data_sim/", recursive = F)
paths <- paths[grep("rep_", paths)]

# make df
data = CJ(
  path = paths
)

# get replicate
data[, rep := as.numeric(
  stringr::str_extract_all(path, "rep_(\\d{3})") |> 
    stringr::str_extract_all("\\d{3}")
)]

# get sim type
data[, sim_type := stringr::str_extract(
  path, "obligate|facultative|foragers|random"
 ) 
]

data[, regrowth := as.numeric(str_extract(path, "(0\\.\\d+)"))]
```

Read data from paths.

```{r}
# from each simulation
temp_gen_data <- lapply(
  data$path,
  function(x) {
    get_sim_weight_evol(
      data_folder = x,
      generations = unique(
        c(
          seq(1, 100, 1), 
          seq(100, 999, 25), 
          999
        )
      ),
      which_weight = NA
    )
  }
)
```

```{r}
# bind with parameters
data[, wt_data := temp_gen_data]

# unnest
data <- data[, unlist(wt_data, recursive = F),
  by = list(sim_type, rep, regrowth)
]
fwrite(data, file = "data_sim/results/data_sparse_weight_evolution.csv")
```
